<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- club 홍보  페이지에 보통 쓰일 쿼리들 모을 예정 -->
<mapper namespace="ClubAdvertise">

	<select id="readClubAdvertisePreview"
		resultType="com.walab.hgu.DTO.ClubAdvertiseDTO"
		parameterType="hashmap">
		select  CA.id,title, content, originalUrl
		from clubAdvertise CA LEFT JOIN clubAdvertiseImage cAF on CA.id = cAF.clubAdvertiseId
		ORDER BY CA.regdate DESC
		LIMIT #{displayPost}, #{postNum}
		<!-- SELECT CA.id,title, content, originalUrl FROM hguclub.clubAdvertise CA
    	LEFT JOIN clubAdvertiseFile cAF on CA.id = cAF.clubAdvertiseId WHERE cAF.order = 1 ORDER BY CA.regdate DESC -->
	</select>
	
	<select id="readClubAdvertiseDetail" resultType="com.walab.hgu.DTO.ClubAdvertiseDTO"
		parameterType="hashmap">
			SELECT CA.id,title,content, CA.regdate
			FROM clubAdvertise CA 
			WHERE id = #{id}
	</select>
	
	<select id="readClubAdvertiseDetailId"
		resultType="com.walab.hgu.DTO.ClubAdvertiseDTO"
		parameterType="hashmap">
		SELECT CA.id, CAF.fileOriginalUrl 
			FROM clubAdvertise CA , hguclub.clubAdvertiseFile as CAF
			WHERE CA.id = #{id} and CA.id=CAF.clubAdvertiseId LIMIT 1
	</select>
	
	<select id="readRecentClubAd" resultType="int"
		parameterType="hashmap">
		SELECT MAX(id) FROM hguclub.clubAdvertise
	</select>
	
	<select id="getClubAdImg" resultType="com.walab.hgu.DTO.ClubAdvertiseDTO"
		parameterType="hashmap">
			SELECT originalUrl
			FROM clubAdvertiseImage RIGHT JOIN clubAdvertise cA on cA.id = clubAdvertiseImage.clubAdvertiseId
			WHERE clubAdvertiseId = #{id} ORDER BY `order`
			
	</select>
	
	<select id="countInfo" resultType="int">
		SELECT COUNT(*) as listCnt
		FROM clubAdvertise
	</select>
	
	<!-- 동아리 홍보  업로드 쿼리 -->
	<insert id="createClubAd" parameterType="com.walab.hgu.DTO.ClubAdvertiseDTO">
		INSERT INTO hguclub.clubAdvertise (title,content)
		VALUES (#{title},#{content})
	</insert>
	
	<!-- 동아리 홍보 이미지 업로드 쿼리 -->
	<insert id="createClubAdImage"
		parameterType="com.walab.hgu.DTO.FileDTO">
		INSERT INTO hguclub.clubAdvertiseImage (clubAdvertiseId,
		originalUrl)
		VALUES (#{clubAdvertiseId}, #{originalUrl})
	</insert>
	
	<!-- 동아리 홍보 일반 파일 업로드 쿼리 -->
	<insert id="createClubAdFile"
		parameterType="com.walab.hgu.DTO.FileDTO">
		INSERT INTO hguclub.clubAdvertiseFile (clubAdvertiseId,
		fileOriginalUrl)
		VALUES (#{clubAdvertiseId}, #{fileOriginalUrl})
	</insert>
	
	<!-- 동아리 홍보 파일 삭제 쿼리 -->
	<delete id="deleteClubAdvertiseFile"
		parameterType="int">
		DELETE FROM hguclub.clubAdvertiseFile WHERE
		clubAdvertiseId = #{id}
	</delete>
	
	<!-- 동아리 홍보 이미지 삭제 쿼리 -->
	<delete id="deleteClubAdvertiseImage"
		parameterType="int">
		DELETE FROM hguclub.clubAdvertiseImage WHERE
		clubAdvertiseId = #{id}
	</delete>

	<!-- 동아리 홍보 글 삭제 쿼리 -->
	<delete id="deleteClubAdvertise"
		parameterType="int">
		DELETE FROM hguclub.clubAdvertise WHERE id = #{id}
	</delete>

</mapper>