<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- club 소개 페이지에 보통 쓰일 쿼리들 모을 예정 -->
<mapper namespace="Club">

	<select id="readClubIntroductionPreview" parameterType="HashMap" resultType="com.walab.hgu.DTO.ClubDTO">
		SELECT CL.id,CL.clubName, u.name as clubCeoName, CL.clubLocation, u.phone,categoryId, categoryName, CL.foundationDate, cS.instagramLink, cS.facebookLink ,cI.originalUrl
        FROM hguclub.club as CL ,hguclub.clubImage cI ,hguclub.category CA,hguclub.user u ,hguclub.clubSNS cS
		where CA.id = CL.categoryId and CL.userId = u.id and  CL.id = cS.clubId and CL.id = cI.clubId
		and CA.id = #{categoryId} and cI.`order` = 1
		
		AND clubName LIKE concat('%',#{keyword},'%')
	</select>
	
	<select id="readRecentClub" resultType="int"
		parameterType="hashmap">
		SELECT MAX(id) FROM hguclub.club
	</select>
	
	<select id="getCategoryNameList" resultType="com.walab.hgu.DTO.CategoryDTO">
		Select id,categoryName FROM hguclub.category
	</select>
	
	<select id="getClubDetailList" parameterType="HashMap" resultType="com.walab.hgu.DTO.ClubDTO">
		SELECT CL.id,CL.clubName,u.name as clubCeoName,CL.clubLocation,CL.clubDescription,u.phone,categoryId,categoryName,CL.foundationDate,cS.instagramLink,cS.facebookLink ,cI.originalUrl
        FROM hguclub.club as CL ,hguclub.clubImage cI ,hguclub.category CA,hguclub.user u ,hguclub.clubSNS cS
		where CA.id = CL.categoryId and CL.userId = u.id and  CL.id = cS.clubId and CL.id = cI.clubId
		and CA.id = #{categoryId} and CL.id = #{clubId} and cI.`order` = 1
	</select>
	
	<select id="readClubList" parameterType="HashMap" resultType="com.walab.hgu.DTO.ClubDTO">
		SELECT * FROM club
		ORDER BY regdate DESC
		LIMIT #{displayPost}, #{postNum}
	</select>

	<select id="getClubImg" parameterType="HashMap" resultType="com.walab.hgu.DTO.ClubDTO">
		SELECT cI.originalUrl
        FROM hguclub.club as CL ,hguclub.clubImage cI
		where CL.id = cI.clubId
		and CL.id = #{clubId} order by `order`
	</select>
	
	<select id="getAllClubIntroduction" resultType="com.walab.hgu.DTO.ClubDTO" parameterType="hashMap">
		SELECT CL.id,CL.clubName, u.name as clubCeoName, CL.clubLocation, u.phone,categoryId, categoryName, CL.foundationDate, cS.instagramLink, cS.facebookLink ,cI.originalUrl
        FROM hguclub.club as CL ,hguclub.clubImage cI ,hguclub.category CA,hguclub.user u ,hguclub.clubSNS cS
		where CA.id = CL.categoryId and CL.userId = u.id and  CL.id = cS.clubId and CL.id = cI.clubId
		and cI.`order` = 1 
		
		AND clubName LIKE concat('%',#{keyword},'%')
		
		ORDER BY clubName
		<!-- 현재, 이미지가 없는 동아리들은 order자체가 없기 때문에 불러와지지 않는다. 없는 동아리들은 디폴트 이미지를 넣게하면 될 듯  -->
	</select>
	
	
	<select id="getClubList" parameterType="HashMap" resultType="com.walab.hgu.DTO.ClubDTO">
		SELECT id,clubName
		FROM hguclub.club
		order by club.regdate DESC
	</select>
	
	<insert id="createClubSNS" parameterType="com.walab.hgu.DTO.ClubDTO">
		INSERT INTO hguclub.clubSNS (clubId,facebookLink,instagramLink)
		VALUES (#{id},#{facebookLink},#{instagramLink})
	</insert>
	
	<insert id="createClubIntro" parameterType="com.walab.hgu.DTO.ClubDTO">
		INSERT INTO hguclub.club (userId,categoryId,clubName,clubDescription,clubLocation,foundationDate)
		<!-- VALUES (#{categoryId},#{clubName},#{clubDescription},#{foundationDate},#{clubLocation}) -->
		VALUES (#{userId},#{categoryId},#{clubName},#{clubDescription},#{clubLocation},#{foundationDate})
	</insert>
	
	<!-- 동아리 소개 이미지 업로드 쿼리 -->
	<insert id="createClubIntroImage"
		parameterType="com.walab.hgu.DTO.FileDTO">
		INSERT INTO hguclub.clubImage (clubId,
		originalUrl)
		VALUES (#{clubId}, #{originalUrl})
	</insert>
	<select id="getClubIdByName" parameterType="HashMap" resultType="int">
		SELECT id
		FROM club
		WHERE clubName = #{clubName}
	</select>
	<select id="getClubIdByUserId" parameterType="HashMap" resultType="int">
		SELECT id
		FROM club
		WHERE userId = #{userId}
	</select>
	<update id="updateUserClub" parameterType="HashMap" >
		UPDATE club
		SET userId = #{userId}
		WHERE id = #{clubId}
	</update>
	<update id="updateUserNull" parameterType="HashMap">
		UPDATE club
		SET userId = null
		WHERE id = #{clubId}
	</update>
</mapper>